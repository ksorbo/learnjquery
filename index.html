<!DOCTYPE html>
<html>
<head>
    <title>My Page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Include jQuery Mobile stylesheets -->
    <!--<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">-->
    <!--<link rel="stylesheet" type="text/css" href="css/jquery.mobile.flatui.css">-->
    <!-- Include the jQuery library -->
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.1/jquery.mobile-1.2.1.min.css" />
    <script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.2.1/jquery.mobile-1.2.1.min.js"></script>
    <link rel="stylesheet" href="css/custom.css">

    <script src="js/utilities.js"></script>

    <!-- Include the jQuery Mobile library -->
    <!--<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>-->
    <script src="js/handlebars.runtime.min.js"></script>
    <script src="js/helpers.js"></script>
    <script src="js/templates.js"></script>
    <script src="js/scripts.js"></script>
    <script>
        var options = {
            'testimonies': {
                'type': 'testimonies',
                'count': 10,
                'order': 'desc',
                'period': 'thisyear',
                'url': 'http://rest.net211.com/items/',
                'cachetime': 86400
            },
            'prayerneeds': {
                'type': 'prayerneeds',
                'count': 15,
                'order': 'desc',
                'period': 'thisyear',
                'cachetime': 86400,
                'url': 'http://rest.net211.com/items/'
            },
            'totals': {
                'type': 'totals',
                'cachetime': 90,
                'url': 'http://rest.net211.com/totals'
            },
            'livedata': {
                'type': 'livedata',
                'cachetime': 60,
                'url': 'http://rest.net211.com/livedata'
            }

        };

        $(document).ready(function () {
            options.totals.params = 'all';
            fetchItems(options.testimonies);
            fetchItems(options.prayerneeds);
            showTotals();
            $('#select-period').change(function () {
                options.totals.params =  $('#select-period option:selected').val();
                showTotals();
            });
            $(document).on('pagebeforeshow', '#debug', showLocalStorage);
            $(document).on('pagebeforeshow', '#prayerneeds', function(){

                var data = fetchItems(options.prayerneeds);
                $('[data-role="content"]').html(Handlebars.templates.showPrayerNeeds(data))
                        .trigger('create');
            } );
            $(document).on('pagebeforeshow', '#testimonies', function(){
                var data = fetchItems(options.testimonies);
                $('[data-role="content"]').html(Handlebars.templates.showTestimonies(data))
                        .trigger('create');
            });
            $(document).on('pagebeforeshow', '#livedata', function () {
                var data = fetchItems(options.livedata);
                var h = Handlebars.templates.showLiveData(data);
                $('[data-role="content"]').html(h).trigger('create');
                setInterval(showLiveDataTotal, options.livedata.cachetime * 1000);
            });
            $(document).on('pagebeforeshow', '#home', function () {
                showTotals();
                setInterval(showTotals, options.totals.cachetime * 1000);
            });
        });
    </script>


</head>
<body>

<section data-role="page" id="home">
    <div data-role="header" data-theme="b" class="ui-header">
        <h1>Home Page</h1>
    </div>
    <article data-role="main" class="ui-content" id="homecontent">

        <a data-role="button" data-theme="c" class="ui-btn ui-corners " href="#testimonies">Testimonies</a>
        <a data-role="button" data-theme="c" class="ui-btn ui-corners " href="#prayerneeds">Prayer Needs</a>
        <a data-role="button" data-theme="d" class="ui-btn ui-corners " href="#livedata">Live Visits</a>
        <a data-role="button" data-theme="c" class="ui-btn ui-corners " href="#debug">Debug</a>


        <form>
            <div class="ui-field-contain"><label for="select-period">Select Period to View</label>
                <select name="select-period" id="select-period">
                    <option value="all" selected="selected">All Data</option>
                    <option value="2015-01-01/2015-12-31">2015</option>
                    <option value="2014-01-01/2014-12-31">2014</option>
                    <option value="2013-01-01/2013-12-31">2013</option>
                    <option value="2012-01-01/2012-12-31">2012</option>
                    <option value="2011-01-01/2011-12-31">2011</option>
                    <option value="2010-01-01/2010-12-31">2010</option>
                    <option value="2009-01-01/2009-12-31">2009</option>
                        </select>
            </div>
        </form>
        <div id="totalsarea"></div>
        <div id="totalsarea2"></div>
    </article>
</section>

<section data-role="page" id="livedata">
    <div data-role="header" data-theme="b" class="ui-header">
        <a data-role="button" href="#home">Home</a>
        <h1>Live Data</h1>
    </div>
    <article data-role="content" id="livedatatotal">
    </article>
</section>

<section data-role="page" id="prayerneeds" onload="showPrayerNeeds();">
    <div data-role="header" data-theme="b" class="ui-header">
        <a data-role="button" href="#home">Home</a>
        <h1>Prayer Needs from Inquirers</h1>
    </div>
    <!-- /header -->
    <article data-role="content" id="prayerneedsList">
    </article>
</section>

<section data-role="page" id="testimonies">
    <div data-role="header" data-theme="b" class="ui-header">
        <a data-role="button" href="#home">Home</a>
        <h1>Testimonies</h1>
    </div>
    <!-- /header -->

    <div data-role="content" id="testimoniesList">
    </div>
    <!-- /content -->
</section>
<!-- /page -->
<section data-role="page" id="debug" onload="showLocalStorage();">
    <div data-role="header" data-theme="b" class="ui-header">

        <button onclick="clearCache();">Clear Cache</button>
        <h1>Debug Page</h1>
    </div>
    <!-- /header -->
    <article data-role="content" id="debugcontent">

    </article>
</section>
<div data-role="footer" data-id="footer-fixed" data-position="fixed" class="ui-footer-fixed">

    <a data-role="button" href="#home">Home</a>
    <a data-role="button" href="#testimonies">Testimonies</a>
</div>
<!--<script src="bower_components/jquery/dist/jquery.min.js"></script>-->
<!--<script src="bower_components/jquery-mobile/js/jquery.mobile.js"></script>-->
<script>
    showLiveDataTotal();
</script>
</body>
</html>